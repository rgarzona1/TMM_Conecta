{% extends 'general.html' %} 
{% load static %}

{% block content %}
<section class="tienda-main-content">
    <h1 class="tienda-titulo">Nuestra Tienda</h1>
    
    <p class="tienda-descripcion">
        Descubre nuestros productos artesanales y sorpresas especiales.
    </p>
    
    <div class="tienda-busqueda">
        <input type="search" id="buscar-producto" placeholder="Buscar producto..." class="busqueda-input">
    </div>
    
    <div class="productos-grid">
        {% for producto in productos %}
        <div class="producto-card">
            <!-- Imagen arriba como en talleres -->
            <img src="{% if producto.imagen %}{{ producto.imagen.url }}{% else %}{% static 'tienda/default_prod.png' %}{% endif %}" 
                 alt="{{ producto.nombre }}" 
                 class="producto-imagen">
            
            <!-- Nombre centrado -->
            <h3 class="producto-nombre">{{ producto.nombre }}</h3>
            
            <!-- Info del producto -->
            <div class="producto-info">
                <p class="producto-descripcion">
                    {{ producto.descripcion_corta }}
                </p>
                
                <!-- Precio destacado -->
                <div class="producto-precio">${{ producto.precio|floatformat:"0" }} CLP</div>
                
                <!-- Formulario con botón -->
                <form action="{% url 'add_to_cart_producto' producto.id %}" method="post" class="producto-form">
                    {% csrf_token %}
                    <button type="submit" class="btn-comprar">
                        Agregar al Carrito
                    </button>
                </form>
            </div>
        </div>
        {% empty %}
        <div class="producto-vacio">
            <p>¡Aún no tenemos productos disponibles! Vuelve pronto.</p>
        </div>
        {% endfor %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const buscarInput = document.getElementById('buscar-producto');
    const productoCards = document.querySelectorAll('.producto-card');
    
    if (buscarInput) {
        buscarInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            let visibleCount = 0;
            
            productoCards.forEach(card => {
                const nombre = card.querySelector('.producto-nombre').textContent.toLowerCase();
                const descripcion = card.querySelector('.producto-descripcion').textContent.toLowerCase();
                
                if (nombre.includes(searchTerm) || descripcion.includes(searchTerm)) {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                    visibleCount++;
                } else {
                    card.style.opacity = '0.3';
                    card.style.transform = 'scale(0.95)';
                }
            });
            
            // Mensaje si no hay resultados
            const mensajeVacio = document.querySelector('.producto-vacio');
            if (mensajeVacio) {
                mensajeVacio.style.display = visibleCount === 0 ? 'block' : 'none';
            }
        });
    }
});
</script>

<style>
.producto-card {
    transition: all 0.3s ease;
}
</style>
{% endblock content %}