{% extends 'general.html' %}
{% block title %}Panel de la Due침a{% endblock %}

{% block content %}
<section class="perfil-section panel-duena">
  <div class="perfil-container panel-duena-container">
    
    <aside class="perfil-sidebar">
      <div class="perfil-avatar-area">
        <div class="perfil-avatar">
          <img src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Avatar">
        </div>
        <h2>caro</h2>
        <p>duena@tmmconecta.cl</p>
      </div>

      <div class="perfil-buttons">
        <a href="{% url 'editar_perfil' %}" class="btn-edit">Editar perfil</a>
        <a href="{% url 'logout' %}" class="btn-logout">Cerrar sesi칩n</a>
      </div>
    </aside>

    <main class="perfil-main">

      <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 10px;">
        {% if modo_demo %}
          <a href="{% url 'panel_duena_inicio' %}" class="btn-panel">游댋 Desactivar datos de prueba</a>
          <p style="color: #777; margin-top: 8px;">游댲 Modo demostraci칩n activado</p>
        {% else %}
          <a href="{% url 'panel_duena_inicio' %}?demo=1" class="btn-panel">丘뙖잺 Activar datos de prueba</a>
        {% endif %}
      </div>

      <div class="panel-graficos" style="width: 100%; margin-top: 10px;">
        <h3 style="margin-bottom: 20px;">Estad칤sticas del Negocio</h3>

        <div class="graficos-grid">
          
          <div style="background-color: #fff6fa; border-radius: 12px; padding: 15px; 
                      box-shadow: 0 2px 6px rgba(0,0,0,0.05); width: 100%; max-width: 380px;">
            <h4 style="text-align: center;">Productos por Categor칤a</h4>
            <canvas id="graficoCategorias" height="180"></canvas>
          </div>

          <div style="background-color: #fff6fa; border-radius: 12px; padding: 15px; 
                      box-shadow: 0 2px 6px rgba(0,0,0,0.05); width: 100%; max-width: 380px;">
            <h4 style="text-align: center;">Tipo de Taller</h4>
            <canvas id="graficoTipo" height="180"></canvas>
          </div>

          <div style="background-color: #fff6fa; border-radius: 12px; padding: 15px; 
                      box-shadow: 0 2px 6px rgba(0,0,0,0.05); width: 100%; max-width: 380px;">
            <h4 style="text-align: center;">Talleres por Mes</h4>
            <canvas id="graficoMeses" height="180"></canvas>
          </div>

        </div>
      </div>

      <section class="perfil-promos">
        <h3>Panel de Administraci칩n</h3>
        <p>Gestiona tus contenidos y revisa el estado de tu negocio.</p>

        <div class="promo-grid panel-grid">

          <div class="promo-card panel-card">
            <img src="https://cdn-icons-png.flaticon.com/512/1828/1828673.png" alt="Talleres">
            <h4>Talleres</h4>
            <p>Administra los talleres activos o crea nuevos.</p>
            <a href="{% url 'panel_talleres' %}" class="btn-panel">Ir a talleres</a>
          </div>

          <!-- INSUMOS -->
          <div class="promo-card panel-card">
            <img src="https://cdn-icons-png.flaticon.com/512/3050/3050155.png" alt="Insumos">
            <h4>Insumos</h4>
            <p>Administra los productos e insumos de la tienda.</p>
            <a href="{% url 'panel_insumos' %}" class="btn-panel">Ir a insumos</a>
          </div>

          <div class="promo-card panel-card">
            <img src="https://cdn-icons-png.flaticon.com/512/2331/2331970.png" alt="Ventas">
            <h4>Ventas</h4>
            <p>Consulta los pagos realizados y pendientes.</p>
            <a href="{% url 'panel_ventas' %}" class="btn-panel">Ver ventas</a>
          </div>

          <div class="promo-card panel-card">
            <img src="https://cdn-icons-png.flaticon.com/512/747/747376.png" alt="Usuarios">
            <h4>Usuarios</h4>
            <p>Consulta y gestiona los usuarios registrados.</p>
            <a href="{% url 'panel_usuarios' %}" class="btn-panel">Ver usuarios</a>
          </div>

          <div class="promo-card panel-card">
            <img src="https://cdn-icons-png.flaticon.com/512/2921/2921222.png" alt="Cupones">
            <h4>Cupones</h4>
            <p>Crear y asignar descuentos para clientes.</p>
            <a href="{% url 'panel_cupones' %}" class="btn-panel">Ir a cupones</a>
          </div>


        </div>
      </section>

    </main>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const colores = ['#ff99c8', '#a0c4ff', '#bdb2ff', '#ffc6ff', '#fdffb6', '#caffbf'];

  // 游댳 Datos desde Django (reales o demo)
  const labels_categorias = JSON.parse('{{ labels_categorias|escapejs }}');
  const data_categorias = JSON.parse('{{ data_categorias|escapejs }}');
  const labels_tipo = JSON.parse('{{ labels_tipo|escapejs }}');
  const data_tipo = JSON.parse('{{ data_tipo|escapejs }}');
  const labels_meses = JSON.parse('{{ labels_meses|escapejs }}');
  const data_meses = JSON.parse('{{ data_meses|escapejs }}');

  // 游댳 Gr치fico 1 - Categor칤as
  new Chart(document.getElementById('graficoCategorias'), {
    type: 'bar',
    data: {
      labels: labels_categorias,
      datasets: [{
        label: 'Productos',
        data: data_categorias,
        backgroundColor: colores
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });

  // 游댳 Gr치fico 2 - Tipo de Taller
  new Chart(document.getElementById('graficoTipo'), {
    type: 'doughnut',
    data: {
      labels: labels_tipo,
      datasets: [{
        data: data_tipo,
        backgroundColor: ['#bde0fe', '#ffc8dd']
      }]
    },
    options: { plugins: { legend: { position: 'bottom' } } }
  });

  // 游댳 Gr치fico 3 - Talleres por Mes
  new Chart(document.getElementById('graficoMeses'), {
    type: 'line',
    data: {
      labels: labels_meses,
      datasets: [{
        label: 'Talleres Programados',
        data: data_meses,
        borderColor: '#ffafcc',
        tension: 0.3,
        fill: true,
        backgroundColor: 'rgba(255,175,204,0.2)'
      }]
    },
    options: { plugins: { legend: { position: 'bottom' } } }
  });
</script>
{% endblock %}